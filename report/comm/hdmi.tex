\documentclass[../main/report.tex]{subfiles}
\begin{document}
Many logically separate parts of the Design work together to enable the video output.
The part that fetches video-data from the current framebuffer in memory.
The part that buffers the incoming data.
The part that generates the video-timings.
The part that codes the signal as TDMS.
And the part that serializes the output signal.
At that comes the clocking-infrastructure.

Note that everything in the section applies equally to DVI-I as HDMI. HDMI is a superset of DVI-I, and nothing exclusive to HDMI is made use of.
Also, as video-timings of DVI are inherited from VGA, everything except the TDMS-encoder would be useful for VGA-output.

The HDMI-specification describes a streaming protocol.
The receiver of the video cannot be relied on to wait and retain a frame when the video-output cannot send.

Thus, central in the design is the buffering-unit.
As the GPU has always first priority on access to the memory, it is not always available to the video-output.
The video-output relies on that there will be enough free timeslots for memory-access when the GPU is otherwise busy to get data for video-out.
Whenever data is opportunistically returned from memory, it is stashed into a FIFO until it's full.

Where data is requested from in memory, is decided by a counter that runs through the address-space of the current framebuffer.
When data is put onto the FIFO, the counter increments. % Yes, `increments` can be intransitive.

When the counter reaches the end of the framebuffer, it is reset to the start the of framebuffer to be displayed next.
This logic also prevents tearing (caused by switching buffers mid-frame).

To give the buffer as much chance as possible to have data available, it is read out as slowly as possible.
For HDMI this minimum scanout rate is \SI{25}{Mpx\per s}.
To facilitate this, the FIFO crosses clock-domains from memory-speed to \SI{25}{MHz}.

\todo{Say something about memory returning two pixels at a time.}

The video-timing-unit generates video-control-signals, and dequeues pixels of the FIFO when the image is being sent.
\todo{Explain video-timings, and cite the spec.}

The control-signals and pixel-data are split into three channels and encoded with a TDMS-scheme.
The scheme encodes either 8-bit color-values when sending a image or 2-bit control-values when blanking, using 10 bits.
Each channel is then serialized using a shift-register and DDR-output, outputted using differential-signaling.
The pixel-clock is also outputted, using differential-signaling.
\todo{Explain the OBUFDS. Why not just a ``not''.}
\end{document}