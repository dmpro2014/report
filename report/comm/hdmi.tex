\documentclass[../main/report.tex]{subfiles}
\begin{document}

HDMI is an interface for transmitting live video and audio.
It is widely popular in consumer TVs and computer screens.
\todo{[Citation needed]}
It was decided that Demolicious will use HDMI for its video output, making it easy to connect to any recent video display.

The HDMI specification describes a streaming protocol.
The receiver reads data off of the cable at a steady rate.
In the design of Demolicious, the GPU has priority access to the memory.
The video unit has to wait whenever that happens.
This means that the video unit may not have access to the framebuffer (which lies in memory) when it's time to send a pixel.
To solve this issue, a buffer is used.
Whenever the memory is idle, as much of the framebuffer as there is room for is prefetched into the buffer.

The pixels are sent at a rate of 25 million pixels per second.
This is the slowest the specification allows for and gives the most time for the buffer to fill in time.
Should the buffer still underflow, the sending of the late pixels must be abandoned so as to stay synchronized with the position they will appear at on the screen.
When the end of the framebuffer is reached, the start address for the framebuffer is updated to the one selected by the CPU.
This ensures that only complete frames of video are output, thus preventing artifacts known as \emph{video tearing}.
This technique is known as \emph{V-sync} with \emph{double buffering}.

Video is sent over HDMI one horizontal line at a time.
Between each line is a pause known as the blanking period.
This is inherited from signaling driving CRT displays.
In a CRT screen, an electron beam swipes horizontally, drawing on the phosphor screen.
The beam needs time to be steered back to the beginning of the next line.
During this time, known as the blanking period, the beam is at lowest intensity (or off).
In HDMI this period is used for sending control signals (and auxiliary data, such as sound) instead of video data.
There is also a corresponding blanking period for the vertical end of the picture.

These control signals are generated by the video timing unit.
The control signals assert where in the data stream a new frame of video starts, where a new line starts and whether it's the blanking period.
These allow the receiver to determine the resolution and refresh rate of the video.

When it is not the blanking period, pixels are sent.
However, the lowest resolution HDMI allows for is 640x480.
This is larger than our framebuffers, so a letterbox (frame) is added around the picture.
For debugging purposes, the letterbox is a low-contrast checker pattern.
When the video timing unit indicates that it is in the actual video-portion of the screen, pixels are taken from the buffer to be output.

To send the data over HDMI, the control signals and pixel data are split into three channels (one for each color) and encoded using the TMDS scheme, the purpose of which is to minimize noise on the physical connection.
The scheme uses 10-bit to encode either 8-bit color-values when sending a image or 2-bit control values when blanking.
Each channel is then serialized before being output together with a clock using differential-signaling.

\end{document}